#!/usr/bin/env python3

import argparse
import os
import subprocess
import tempfile

parser = argparse.ArgumentParser()
parser.add_argument('run_dirs', nargs='*')
parser.add_argument('--port', type=int, default=6006)
args = parser.parse_args()

if len(args.run_dirs) == 1:
    tensorboard_dir = args.run_dirs[0]
else:
    tensorboard_dir = tempfile.mkdtemp()
    for path in args.run_dirs:
        os.symlink(os.path.abspath(path),
                   os.path.join(tensorboard_dir, os.path.basename(path)))

subprocess.run(['pkill', '-f', f'tensorboard --port {args.port}'])
proc = subprocess.Popen(['tensorboard', '--port', str(args.port), '--logdir', tensorboard_dir],
                        stdout=subprocess.PIPE, stderr=subprocess.PIPE)
proc.stderr.readline()
subprocess.Popen(['n', str(args.port)])
try:
    input()
except KeyboardInterrupt:
    pass
proc.terminate()